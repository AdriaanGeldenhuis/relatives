/**
 * NEON NIBBLER - Level Definitions
 * Cell types: 0=wall, 1=dot, 2=power, 3=empty, 4=player, 5=sentinel
 * Grid: 21x21
 */
var NeonLevels = (function() {
    'use strict';

    // Level 1: Circuit Board - symmetrical with corridors
    var level1 = [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0],
        [0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0],
        [0,2,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,2,0],
        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
        [0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0],
        [0,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,0],
        [0,0,0,0,0,1,0,0,0,3,0,3,0,0,0,1,0,0,0,0,0],
        [0,0,0,0,0,1,0,3,3,3,3,3,3,3,0,1,0,0,0,0,0],
        [0,0,0,0,0,1,0,3,0,0,5,0,0,3,0,1,0,0,0,0,0],
        [3,3,3,3,3,1,3,3,0,5,5,5,0,3,3,1,3,3,3,3,3],
        [0,0,0,0,0,1,0,3,0,0,0,0,0,3,0,1,0,0,0,0,0],
        [0,0,0,0,0,1,0,3,3,3,3,3,3,3,0,1,0,0,0,0,0],
        [0,0,0,0,0,1,0,3,0,0,0,0,0,3,0,1,0,0,0,0,0],
        [0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0],
        [0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0],
        [0,2,1,1,0,1,1,1,1,1,4,1,1,1,1,1,0,1,1,2,0],
        [0,0,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,0,0],
        [0,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,0],
        [0,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0],
        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ];

    // Level 2: Diamond Core - open center with diagonal corridors
    var level2 = [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0],
        [0,1,0,0,1,0,1,0,0,0,0,0,0,0,1,0,1,0,0,1,0],
        [0,1,0,2,1,1,1,1,1,1,0,1,1,1,1,1,1,2,0,1,0],
        [0,1,1,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,1,1,0],
        [0,0,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,0,0],
        [0,1,1,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,1,1,0],
        [0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0],
        [0,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0],
        [0,1,1,1,1,1,1,1,0,3,0,3,0,1,1,1,1,1,1,1,0],
        [0,0,0,0,0,1,0,0,0,5,5,5,0,0,0,1,0,0,0,0,0],
        [0,1,1,1,1,1,1,1,0,3,0,3,0,1,1,1,1,1,1,1,0],
        [0,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0],
        [0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0],
        [0,1,1,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,1,1,0],
        [0,0,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,0,0],
        [0,1,1,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,1,1,0],
        [0,1,0,2,1,1,1,1,1,1,4,1,1,1,1,1,1,2,0,1,0],
        [0,1,0,0,1,0,1,0,0,0,0,0,0,0,1,0,1,0,0,1,0],
        [0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ];

    // Level 3: Spiral Fortress - winding paths
    var level3 = [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,0],
        [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
        [0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0],
        [0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0],
        [0,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0],
        [0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0],
        [0,1,0,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,0,1,0],
        [0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0],
        [0,1,0,1,0,1,0,1,0,5,5,5,0,1,0,1,0,1,0,1,0],
        [0,1,1,1,0,1,0,1,0,5,3,5,0,1,0,1,0,1,1,1,0],
        [0,0,0,1,0,1,0,1,0,0,3,0,0,1,0,1,0,1,0,0,0],
        [0,1,1,1,0,1,0,1,1,1,3,1,1,1,0,1,0,1,1,1,0],
        [0,1,0,0,0,1,0,0,0,0,3,0,0,0,0,1,0,0,0,1,0],
        [0,1,0,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,0,1,0],
        [0,1,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,1,0],
        [0,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,1,1,1,1,0],
        [0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],
        [0,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,0],
        [0,2,0,0,0,1,0,1,0,1,1,1,0,1,0,1,0,0,0,2,0],
        [0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ];

    var mazes = [level1, level2, level3];

    function getMaze(levelNum) {
        // Cycle through mazes, add speed modifier for higher levels
        var idx = (levelNum - 1) % mazes.length;
        // Deep copy
        var maze = [];
        for (var r = 0; r < mazes[idx].length; r++) {
            maze.push(mazes[idx][r].slice());
        }
        return maze;
    }

    function getLevelConfig(levelNum) {
        // Difficulty scaling
        var baseSpeed = 3.5;
        var speedIncrease = Math.min(levelNum * 0.3, 3.0);
        var pulseDuration = Math.max(8000 - (levelNum - 1) * 500, 3000);
        var chaseInterval = Math.max(3000 - (levelNum - 1) * 200, 800);

        return {
            playerSpeed: baseSpeed + speedIncrease * 0.6,
            sentinelSpeed: baseSpeed + speedIncrease * 0.5,
            pulseDuration: pulseDuration,
            chaseInterval: chaseInterval,
            scatterDuration: Math.max(7000 - (levelNum - 1) * 300, 3000),
            levelBonus: 500,
            timeBonusPerSec: 5,
            timeBonusMax: 300
        };
    }

    function countDots(maze) {
        var count = 0;
        for (var r = 0; r < maze.length; r++) {
            for (var c = 0; c < maze[r].length; c++) {
                if (maze[r][c] === 1 || maze[r][c] === 2) count++;
            }
        }
        return count;
    }

    function findPlayer(maze) {
        for (var r = 0; r < maze.length; r++) {
            for (var c = 0; c < maze[r].length; c++) {
                if (maze[r][c] === 4) return { row: r, col: c };
            }
        }
        return { row: 16, col: 10 };
    }

    function findSentinels(maze) {
        var positions = [];
        for (var r = 0; r < maze.length; r++) {
            for (var c = 0; c < maze[r].length; c++) {
                if (maze[r][c] === 5) positions.push({ row: r, col: c });
            }
        }
        return positions;
    }

    return {
        getMaze: getMaze,
        getLevelConfig: getLevelConfig,
        countDots: countDots,
        findPlayer: findPlayer,
        findSentinels: findSentinels,
        ROWS: 22,
        COLS: 21
    };
})();
